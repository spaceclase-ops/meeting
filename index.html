<!DOCTYPE html>
<html lang="he" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>לוח פגישות אונליין - סניף נשר</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: { sans: ['Heebo', 'sans-serif'] },
            colors: {
              primary: { 50: '#f3f1ff', 100: '#ebe5ff', 200: '#d9cfff', 300: '#bea6ff', 400: '#a17aff', 500: '#844dff', 600: '#793af2', 700: '#6b2bd9', 800: '#5a24b3', 900: '#4b1e95', 950: '#2c0f5e' },
              dark: { 800: '#1e1e2e', 900: '#11111b', 950: '#0a0a0f' }
            },
            boxShadow: {
              'glow': '0 0 20px rgba(132, 77, 255, 0.4)',
              'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
            },
            backgroundImage: {
                'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))'
            }
          },
        },
      }
    </script>
    <style>
        body { 
            background-color: #0a0a0f; 
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(132, 77, 255, 0.15), transparent 40%),
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 20px 20px, 20px 20px;
            color: #e2e8f0;
        }
        .glass { 
            background: rgba(30, 30, 46, 0.70); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
        }
        .glass-light {
             background: rgba(255, 255, 255, 0.05);
             border: 1px solid rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0f; }
        ::-webkit-scrollbar-thumb { background: #4b1e95; border-radius: 4px; }
        .hide { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @media (max-width: 768px) {
            .mobile-card { @apply glass p-4 rounded-2xl mb-4 border-0; }
        }
    </style>
</head>
<body class="antialiased tracking-tight">
    <div id="app" class="min-h-screen relative overflow-hidden">
        <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center p-4 hide">
            <div class="absolute inset-0 bg-gradient-radial from-primary-900/20 to-transparent opacity-40"></div>
            <div class="glass p-8 sm:p-10 rounded-[2rem] shadow-glass w-full max-w-md animate-in relative z-10">
                <div class="text-center mb-10">
                    <div class="inline-flex p-4 rounded-full bg-gradient-to-br from-primary-500 to-primary-700 text-white mb-6 shadow-glow">
                        <i data-lucide="shield-check" class="w-10 h-10"></i>
                    </div>
                    <h2 class="text-3xl font-black text-white tracking-tight">התחברות למערכת</h2>
                    <p class="text-slate-400 text-sm mt-2 font-medium uppercase tracking-wide">סניף נשר</p>
                </div>
                <form id="login-form" class="space-y-5">
                    <div>
                        <input type="email" id="email" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-xl focus:border-primary-500 outline-none transition-all text-white placeholder-slate-600" placeholder="אימייל">
                    </div>
                    <div>
                        <input type="password" id="password" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-xl focus:border-primary-500 outline-none transition-all text-white placeholder-slate-600" placeholder="סיסמה">
                    </div>
                    <div id="login-error" class="text-rose-400 text-sm font-medium text-center hide"></div>
                    <button type="submit" id="login-btn" class="w-full py-4 rounded-xl bg-gradient-to-r from-primary-600 to-primary-800 text-white font-black text-lg shadow-glow hover:from-primary-500 hover:to-primary-700 transition-all">
                        כניסה מאובטחת
                    </button>
                </form>
            </div>
        </div>

        <div id="dashboard" class="hide pb-20">
            <header class="fixed top-0 left-0 right-0 z-40 glass border-b-0">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-24 flex items-center justify-between">
                    <div class="flex items-center gap-5">
                        <div class="bg-gradient-to-br from-primary-500 to-primary-800 text-white p-3 rounded-2xl shadow-glow">
                            <i data-lucide="trending-up" class="w-7 h-7"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl sm:text-3xl font-black text-white tracking-tight leading-none">לוח פגישות אונליין</h1>
                            <span class="text-xs text-primary-300 font-bold tracking-widest uppercase mt-1 block">סניף נשר</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                          <button id="add-meeting-btn" class="bg-gradient-to-r from-primary-600 to-primary-800 text-white px-4 sm:px-6 py-3 rounded-full hover:from-primary-500 hover:to-primary-700 transition-all flex items-center gap-3 font-bold shadow-glow">
                            <i data-lucide="plus-circle" class="w-5 h-5"></i>
                            <span class="hidden sm:inline">פגישה חדשה</span>
                        </button>
                          <button id="logout-btn" class="p-3 text-slate-400 hover:text-rose-400 glass-light rounded-full transition-all border-0">
                            <i data-lucide="power" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </header>

            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-32 space-y-8">
                
                <div class="glass p-4 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div class="text-white font-bold flex items-center gap-2">
                        <i data-lucide="calendar-range" class="w-5 h-5 text-primary-400"></i> טווח תצוגה:
                    </div>
                    <div class="flex items-center gap-3 w-full sm:w-auto">
                        <input type="date" id="filter-date-start" class="bg-dark-950/50 border border-slate-700 rounded-lg text-white px-3 py-2 w-full sm:w-auto [&::-webkit-calendar-picker-indicator]:filter [&::-webkit-calendar-picker-indicator]:invert">
                        <span class="text-slate-500">→</span>
                        <input type="date" id="filter-date-end" class="bg-dark-950/50 border border-slate-700 rounded-lg text-white px-3 py-2 w-full sm:w-auto [&::-webkit-calendar-picker-indicator]:filter [&::-webkit-calendar-picker-indicator]:invert">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="stats-container"></div>

                <div class="glass p-6 rounded-[2rem] shadow-glow relative overflow-hidden">
                    <h3 class="text-white font-bold text-lg mb-6 flex items-center gap-2 z-10 relative">
                        <i data-lucide="bar-chart-3" class="text-primary-400"></i> עומס פגישות שבועי
                    </h3>
                    <div class="relative w-full h-64 sm:h-80 z-10">
                        <canvas id="meetingsChart"></canvas>
                    </div>
                    <div class="absolute top-0 right-0 w-64 h-64 bg-primary-600/10 blur-[100px] rounded-full pointer-events-none"></div>
                </div>

                <div class="space-y-6">
                    <div class="relative w-full md:w-72 group">
                         <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-5 h-5"></i>
                         <input type="text" id="search-input" placeholder="חיפוש..." class="w-full pr-4 pl-12 py-3 glass-light rounded-full focus:border-primary-500/50 outline-none text-sm transition-all text-white placeholder-slate-500 border-0">
                    </div>
                    
                    <div class="overflow-x-auto rounded-[2rem] glass border-0 p-2">
                        <table class="w-full text-sm text-right border-separate border-spacing-y-2 px-2">
                            <thead class="text-slate-400 font-bold text-xs uppercase tracking-wider hidden md:table-header-group">
                                <tr>
                                    <th class="px-6 py-4">מועד</th>
                                    <th class="px-6 py-4">לקוח</th>
                                    <th class="px-6 py-4">סטטוס</th>
                                    <th class="px-6 py-4">נציג</th>
                                    <th class="px-6 py-4">מנוי</th>
                                    <th class="px-6 py-4 text-center">תזכורת</th>
                                    <th class="px-6 py-4"></th>
                                </tr>
                            </thead>
                            <tbody id="meetings-table-body" class="space-y-4"></tbody>
                        </table>
                        
                        <div id="loading-spinner" class="py-20 flex justify-center hide">
                            <div class="w-12 h-12 rounded-full border-4 border-primary-900/30 border-t-primary-500 animate-spin"></div>
                        </div>
                          <div id="empty-state" class="py-24 text-center hide">
                            <i data-lucide="calendar-off" class="w-12 h-12 text-slate-600 mx-auto mb-4"></i>
                            <h3 class="text-xl font-bold text-white mb-2">אין פגישות להצגה</h3>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <div id="meeting-modal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 hide">
             <div class="absolute inset-0 bg-dark-950/80 backdrop-blur-md transition-opacity"></div>
            <div class="glass rounded-t-[2.5rem] sm:rounded-[2.5rem] shadow-glass w-full max-w-2xl animate-in relative z-10 border-0 my-auto max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center p-6 border-b border-slate-800 sticky top-0 glass z-20">
                    <h2 id="modal-title" class="text-2xl font-black text-white">פגישה חדשה</h2>
                    <button id="close-modal-btn" class="p-2 rounded-full glass-light text-slate-400 hover:text-white border-0"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <form id="meeting-form" class="p-6 space-y-6">
                    <input type="hidden" id="meeting-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-2">
                            <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">שם הלקוח</label>
                            <input type="text" id="m-clientName" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white">
                        </div>
                        <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">תאריך</label>
                             <input type="date" id="m-date" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white [&::-webkit-calendar-picker-indicator]:filter [&::-webkit-calendar-picker-indicator]:invert">
                        </div>
                        <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">שעה</label>
                             <input type="time" id="m-time" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white [&::-webkit-calendar-picker-indicator]:filter [&::-webkit-calendar-picker-indicator]:invert">
                        </div>
                        <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">טלפון</label>
                             <input type="tel" id="m-phone" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white">
                        </div>
                        <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">נציג מטפל</label>
                             <input type="text" id="m-createdBy" required class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white">
                        </div>
                          <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">סוג לקוח</label>
                             <select id="m-clientType" class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white">
                                 <option class="bg-dark-900">מתעניין חדש</option>
                                 <option class="bg-dark-900">לקוח עבר</option>
                             </select>
                        </div>
                          <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">סטטוס</label>
                             <select id="m-status" class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white">
                                 <option class="bg-dark-900">עדיין לא אישר הגעה</option>
                                 <option class="bg-dark-900">אישר הגעה</option>
                                 <option class="bg-dark-900">הגיע לפגישה</option>
                                 <option class="bg-dark-900">לא הגיע לפגישה</option>
                             </select>
                        </div>
                        <div>
                             <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">נמכר מנוי?</label>
                             <select id="m-subscriptionSold" class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white">
                                 <option class="bg-dark-900">לא</option>
                                 <option class="bg-dark-900">כן</option>
                             </select>
                        </div>
                        <div class="flex items-end">
                            <label class="flex items-center gap-4 cursor-pointer bg-dark-950/30 border border-slate-800/50 p-4 rounded-2xl w-full">
                                <input type="checkbox" id="m-reminderSent" class="w-5 h-5 text-primary-600 rounded bg-dark-900 border-slate-600">
                                <span class="text-sm font-bold text-slate-300">בוצעה תזכורת?</span>
                            </label>
                        </div>
                    </div>
                    <div>
                          <label class="text-xs font-bold text-primary-300 block mb-2 uppercase">הערות</label>
                          <textarea id="m-notes" rows="3" class="w-full px-5 py-4 bg-dark-950/50 border border-slate-800 rounded-2xl focus:border-primary-500 outline-none text-white"></textarea>
                    </div>
                    <div class="flex gap-4 pt-4">
                          <button type="button" id="cancel-modal-btn" class="flex-1 py-4 rounded-xl text-slate-300 hover:bg-slate-800 font-bold transition-all">ביטול</button>
                          <button type="submit" class="flex-1 py-4 rounded-xl bg-gradient-to-r from-primary-600 to-primary-800 text-white font-black shadow-glow hover:from-primary-500 hover:to-primary-700 transition-all">שמור</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = (typeof process !== 'undefined' && process.env?.VITE_SUPABASE_URL) || 'https://qtwnkyeaecdumjkokdbk.supabase.co';
        const SUPABASE_KEY = (typeof process !== 'undefined' && process.env?.VITE_SUPABASE_KEY) || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0d25reWVhZWNkdW1qa29rZGJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NTI0MzYsImV4cCI6MjA4MDQyODQzNn0.FVxRtqGnjLXMGvVDR9jF_1oYCXMNyjnmIaNtCFMPD2o';

        const { createClient } = supabase;
        const sb = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // --- HELPER: Get Current Week ---
        function getCurrentWeek() {
            const today = new Date();
            const day = today.getDay(); 
            const sunday = new Date(today);
            sunday.setDate(today.getDate() - day);
            const saturday = new Date(sunday);
            saturday.setDate(sunday.getDate() + 6); 
            return { start: sunday.toISOString().split('T')[0], end: saturday.toISOString().split('T')[0] };
        }
        const currentWeek = getCurrentWeek();

        // --- STATE ---
        let state = {
            user: null, meetings: [], filterStart: currentWeek.start, filterEnd: currentWeek.end, searchTerm: '', chart: null
        };

        const els = {
            authScreen: document.getElementById('auth-screen'), dashboard: document.getElementById('dashboard'),
            loginForm: document.getElementById('login-form'), meetingModal: document.getElementById('meeting-modal'),
            meetingForm: document.getElementById('meeting-form'), tableBody: document.getElementById('meetings-table-body'),
            spinner: document.getElementById('loading-spinner'), emptyState: document.getElementById('empty-state'),
            statsContainer: document.getElementById('stats-container'), dateStart: document.getElementById('filter-date-start'),
            dateEnd: document.getElementById('filter-date-end'), searchInput: document.getElementById('search-input'),
            loginError: document.getElementById('login-error')
        };

        async function init() {
            lucide.createIcons();
            const { data: { session } } = await sb.auth.getSession();
            state.user = session?.user || null;
            sb.auth.onAuthStateChange((_event, session) => { state.user = session?.user || null; renderView(); });
            els.dateStart.value = state.filterStart; els.dateEnd.value = state.filterEnd;
            renderView();
        }

        function renderView() {
            if (!state.user) { els.authScreen.classList.remove('hide'); els.dashboard.classList.add('hide'); }
            else { els.authScreen.classList.add('hide'); els.dashboard.classList.remove('hide'); fetchMeetings(); }
        }

        async function fetchMeetings() {
            els.tableBody.innerHTML = ''; els.spinner.classList.remove('hide'); els.emptyState.classList.add('hide');
            const { data, error } = await sb.from('meetings').select('*').gte('date', state.filterStart).lte('date', state.filterEnd).order('date', { ascending: true }).order('time', { ascending: true });
            els.spinner.classList.add('hide');
            if (error) { console.error('Error:', error); return; }
            state.meetings = data || []; 
            renderMeetings(); 
            renderStats();
            renderChart(); // קריאה לפונקציית הגרף החדשה
        }

        async function saveMeeting(meeting) {
            if (!state.user || !state.user.id) { alert('שגיאה: לא ניתן לזהות משתמש'); return; }
            meeting.user_id = state.user.id; 
            const { error } = await sb.from('meetings').upsert(meeting);
            if (error) { alert('שגיאה בשמירה: ' + error.message); return; }
            closeModal(); fetchMeetings();
        }

        async function deleteMeeting(id) {
            if(!confirm('האם למחוק פגישה זו לצמיתות?')) return;
            const { error } = await sb.from('meetings').delete().eq('id', id);
            if (error) alert(error.message); else fetchMeetings();
        }

        // --- CHART LOGIC (הלוגיקה החדשה של הגרף) ---
        function renderChart() {
            const ctx = document.getElementById('meetingsChart').getContext('2d');
            
            // 1. יצירת מילון של כל התאריכים בטווח (כולל ימים ללא פגישות)
            const dateMap = {};
            let curr = new Date(state.filterStart);
            const end = new Date(state.filterEnd);
            
            while(curr <= end) {
                const dateStr = curr.toISOString().split('T')[0];
                dateMap[dateStr] = 0;
                curr.setDate(curr.getDate() + 1);
            }

            // 2. מילוי הכמויות
            state.meetings.forEach(m => {
                if (dateMap[m.date] !== undefined) dateMap[m.date]++;
            });

            // 3. פרמוט התוויות לגרף (יום עברי + תאריך מקוצר)
            const daysHebrew = ['א\'', 'ב\'', 'ג\'', 'ד\'', 'ה\'', 'ו\'', 'ש\''];
            const labels = Object.keys(dateMap).map(dateStr => {
                const d = new Date(dateStr);
                const dayName = daysHebrew[d.getDay()];
                const shortDate = `${d.getDate()}.${d.getMonth() + 1}`;
                return `${dayName} ${shortDate}`;
            });
            const dataValues = Object.values(dateMap);

            // 4. בניית הגרף (או עדכון אם קיים)
            if (state.chart) state.chart.destroy();

            state.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'כמות פגישות',
                        data: dataValues,
                        backgroundColor: '#844dff',
                        hoverBackgroundColor: '#a17aff',
                        borderRadius: 8,
                        barThickness: 'flex',
                        maxBarThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: 'rgba(30, 30, 46, 0.9)', 
                            titleColor: '#fff', 
                            bodyColor: '#fff',
                            borderColor: 'rgba(132, 77, 255, 0.3)',
                            borderWidth: 1,
                            padding: 10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1, color: '#94a3b8' },
                            grid: { color: 'rgba(255, 255, 255, 0.05)' }
                        },
                        x: {
                            ticks: { color: '#e2e8f0', font: { family: 'Heebo' } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function renderMeetings() {
            const filtered = state.meetings.filter(m => m.client_name.includes(state.searchTerm) || (m.phone && m.phone.includes(state.searchTerm)) || m.created_by.includes(state.searchTerm));
            els.tableBody.innerHTML = '';
            if (filtered.length === 0) { els.emptyState.classList.remove('hide'); return; } else { els.emptyState.classList.add('hide'); }

            filtered.forEach(m => {
                const tr = document.createElement('tr');
                tr.className = 'glass-light hover:bg-slate-800/50 transition-all duration-300 rounded-[1.5rem] group mb-3 md:mb-0 block md:table-row mobile-card';
                let badgeClass = 'bg-amber-950/50 text-amber-300 border-amber-800/50 shadow-[0_0_10px_rgba(251,191,36,0.2)]';
                if(m.status === 'אישר הגעה') badgeClass = 'bg-blue-950/50 text-blue-300 border-blue-800/50 shadow-[0_0_10px_rgba(96,165,250,0.2)]';
                if(m.status === 'הגיע לפגישה') badgeClass = 'bg-emerald-950/50 text-emerald-300 border-emerald-800/50 shadow-[0_0_10px_rgba(52,211,153,0.2)]';
                if(m.status === 'לא הגיע לפגישה') badgeClass = 'bg-rose-950/50 text-rose-300 border-rose-800/50 shadow-[0_0_10px_rgba(251,113,133,0.2)]';

                tr.innerHTML = `
                    <td class="hidden md:table-cell px-6 py-5 first:rounded-r-[1.5rem] border-y border-transparent">
                        <div class="flex flex-col">
                            <span class="font-black text-white text-lg flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4 text-primary-400"></i> ${m.time.slice(0,5)}</span>
                            <span class="text-primary-300 text-xs font-bold uppercase tracking-wider mt-1 bg-primary-950/50 px-2 py-1 rounded-md w-fit">${m.date}</span>
                        </div>
                    </td>
                    <td class="hidden md:table-cell px-6 py-5 border-y border-transparent">
                        <div class="flex flex-col">
                            <span class="font-bold text-white text-base">${m.client_name}</span>
                            <span class="text-xs text-slate-400 mt-1 flex items-center gap-1"><i data-lucide="user" class="w-3 h-3"></i> ${m.client_type || '-'}</span>
                        </div>
                    </td>
                      <td class="hidden md:table-cell px-6 py-5 border-y border-transparent">
                        <span class="px-3 py-1.5 rounded-full text-xs font-bold border ${badgeClass} inline-flex items-center gap-2 backdrop-blur-md">${m.status}</span>
                    </td>
                    <td class="hidden md:table-cell px-6 py-5 border-y border-transparent">
                        <span class="text-slate-200 font-medium flex items-center gap-2"><i data-lucide="shield-user" class="w-4 h-4 text-slate-500"></i> ${m.created_by}</span>
                    </td>
                    <td class="hidden md:table-cell px-6 py-5 border-y border-transparent">
                        ${m.subscription_sold === 'כן' ? '<span class="text-emerald-300 font-bold bg-emerald-950/50 border border-emerald-800/50 px-3 py-1 rounded-lg text-xs shadow-[0_0_10px_rgba(52,211,153,0.2)] flex items-center gap-1 w-fit"><i data-lucide="check-circle-2" class="w-3 h-3"></i> נמכר!</span>' : '<span class="text-slate-600 text-xl font-thin">-</span>'}
                    </td>
                    <td class="hidden md:table-cell px-6 py-5 border-y border-transparent text-center">
                        ${m.reminder_sent ? '<div class="bg-emerald-950/30 p-2 rounded-full inline-flex shadow-[0_0_10px_rgba(52,211,153,0.1)]"><i data-lucide="check" class="w-5 h-5 text-emerald-400"></i></div>' : '<div class="bg-slate-800/50 p-2 rounded-full inline-flex"><i data-lucide="x" class="w-5 h-5 text-slate-600"></i></div>'}
                    </td>
                    <td class="px-6 py-5 last:rounded-l-[1.5rem] border-y border-l border-transparent text-left">
                        <div class="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-all md:flex">
                            <button class="edit-btn p-2.5 text-primary-300 hover:text-white hover:bg-primary-900/50 rounded-xl transition-colors"><i data-lucide="pencil" class="w-5 h-5"></i></button>
                            <button class="del-btn p-2.5 text-rose-400 hover:text-white hover:bg-rose-950/50 rounded-xl transition-colors"><i data-lucide="trash" class="w-5 h-5"></i></button>
                        </div>
                         <div class="md:hidden flex justify-between items-center">
                           <div>
                                <h3 class="font-black text-white text-lg mb-1">${m.client_name}</h3>
                                <p class="text-sm text-primary-300 font-medium flex items-center gap-2"><i data-lucide="calendar-clock" class="w-4 h-4"></i> ${m.date} | ${m.time.slice(0,5)}</p>
                                <div class="mt-3 flex flex-wrap gap-2">
                                     <span class="px-2 py-1 rounded-full text-[10px] font-bold border ${badgeClass}">${m.status}</span>
